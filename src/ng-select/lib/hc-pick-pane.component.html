<div class="hc-pick-search-outer">

    <input #searchInput
        class="hc-pick-search-input"
        [readOnly]="!searchable || itemsList.maxItemsSelected"
        [disabled]="disabled"
        [value]="searchTerm ? searchTerm : ''"
        (input)="filter(searchInput.value)"
        (compositionstart)="onCompositionStart()"
        (compositionend)="onCompositionEnd(searchInput.value)"
        (change)="$event.stopPropagation()"
        (keydown)="onInputKeydown($event)"
        [placeholder]="placeholder"
        role="combobox">

    <ng-container *ngIf="loading">
        Loading...
    </ng-container>
</div>

<div class="hc-picklist-pane-tools">
    <div class="selectbox-stats">
        <ng-container *ngIf="!loading">
            Showing {{itemsList.filteredItems.length.toLocaleString()}} of {{itemsList.items.length.toLocaleString()}}
        </ng-container>
        <ng-container *ngIf="loading">
            Loading...
        </ng-container>
    </div>
    <div>
        <button type="button" hc-button buttonStyle="link-inline" class="hc-font-xsm button-link-inline" (click)="selectAll()" [disabled]="itemsList.filteredItems.length === 0">
            Select All
        </button>
        <button type="button" hc-button buttonStyle="link-inline" class="hc-font-xsm button-link-inline" (click)="deselectAll()" [disabled]="!this.hasSelectedItems">
            Select None
        </button>
    </div>
</div>

<hc-pick-pane-list class="hc-pick-pane-list"
    [ngClass]="{'hc-pane-will-accept-drop': _willAcceptDrop, 'pane-is-active': _paneIsActive}"
    [virtualScroll]="virtualScroll"
    [bufferAmount]="bufferAmount"
    [headerTemplate]="headerTemplate"
    [footerTemplate]="footerTemplate"
    [filterValue]="searchTerm"
    [items]="itemsList.filteredItems"
    [markedItem]="itemsList.markedItem"
    (update)="viewPortItems = $event"
    (scroll)="scroll.emit($event)"
    (scrollToEnd)="scrollToEnd.emit($event)"
    (keydown)="onPanelKeydown($event)"
    (focus)="_paneIsActive = true"
    (blur)="_paneIsActive = false"
    (drop)="dragService.drop($event)" (dragover)="dragService.allowDrop($event)" (dragleave)="dragService.dragLeave()"
    tabIndex="0"
    [id]="dropdownId">

    <ng-container>
        <div class="hc-pick-option" [attr.role]="item.children ? 'group' : 'option'"
            *ngFor="let item of viewPortItems; trackBy: trackByOption; let first = first;"
            (click)="onItemClick($event, item)"
            (dblclick)="onItemDoubledClicked($event, item)"
            draggable="true" (dragstart)="dragService.drag($event, itemsList, item)" (dragend)="dragService.dragEnd()"
            [class.hc-pick-option-disabled]="item.disabled"
            [class.hc-pick-option-selected]="item.selected"
            [class.hc-pick-optgroup]="item.children"
            [class.hc-pick-option]="!item.children"
            [class.hc-pick-option-child]="!!item.parent"
            [class.hc-pick-option-marked]="item === itemsList.markedItem"
            [attr.aria-selected]="item.selected"
            [attr.id]="item?.htmlId">

            <ng-template #defaultOptionTemplate>
                <span class="hc-pick-option-label" [hcPickItemLabel]="item.label" [escape]="escapeHTML"></span>
            </ng-template>

            <ng-template
                [ngTemplateOutlet]="item.children ? (optgroupTemplate || defaultOptionTemplate) : (optionTemplate || defaultOptionTemplate)"
                [ngTemplateOutletContext]="{ item: item.value, item$:item, index: item.index, searchTerm: searchTerm }">
            </ng-template>
        </div>

        <div class="hc-pick-option" [class.hc-pick-option-marked]="!itemsList.markedItem" (mouseover)="itemsList.unmarkItem()" role="option" (click)="selectTag()" *ngIf="showAddTag">
            <ng-template #defaultTagTemplate>
                <span><span class="hc-pick-tag-label">{{addTagText}}</span>"{{searchTerm}}"</span>
            </ng-template>

            <ng-template
                [ngTemplateOutlet]="tagTemplate || defaultTagTemplate"
                [ngTemplateOutletContext]="{ searchTerm: searchTerm }">
            </ng-template>
        </div>
    </ng-container>

    <ng-container *ngIf="showNoItemsFound()">
        <div class="hc-pick-empty-msg"><span>{{notFoundText}}</span></div>
    </ng-container>

    <ng-container *ngIf="loading && itemsList.filteredItems.length === 0">
        <div class="hc-pick-option hc-pick-option-disabled">{{loadingText}}</div>
    </ng-container>

</hc-pick-pane-list>